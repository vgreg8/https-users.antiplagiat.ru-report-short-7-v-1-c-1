var $userId=null,$documentId=null,$reportId=null,$correctionNr=null,$reportViewMode=null,$validationHash=null,$hasSourceIgnored=!1,$isShortReport=!0;$(document).ready(function(){$userId=$("#UserId").length>0?parseInt($("#UserId").val(),10):null,$documentId=parseInt($("#DocId").val(),10),$reportId=parseInt($("#RepId").val(),10),$correctionNr=$("#CorrectionNr").length>0?parseInt($("#CorrectionNr").val(),10):null,$reportViewMode=$("#ReportViewMode").length>0?$("#ReportViewMode").val():null,$validationHash=$("#ValidationHash").length>0?$("#ValidationHash").val():null,$hasSourceIgnored=$("#hasSourceIgnored").length>0&&"true"===$("#hasSourceIgnored").val().toLowerCase(),$("#report-info, #sticky-report-info").bind("click",function(a){setTargetCounters("ParamCheck_ShortReport")}),$("#report-export, #sticky-report-export").bind("click",function(a){$(this).closest(".toolbar-item").hasClass("toolbar-item-disabled")||setTargetCounters("Export_ShortReport")}),$("#report-verification, #sticky-report-verification").bind("click",function(a){setTargetCounters("Certificate_ShortReport")}),$("#report-history, #sticky-report-history").bind("click",function(a){setTargetCounters("HistoryReports_ShortReport")}),$("#report-print, #sticky-report-print").bind("click",function(a){setTargetCounters("Print_ShortReport")}),$("#report-metrics, #sticky-report-metrics").bind("click",function(a){setTargetCounters("TextMetrics_ShortReport")}),$(".report-direct-link").bind("click",function(a){setTargetCounters("Share_ShortReport")}),$("#report-print, #sticky-report-print").confirmIgnoredSources(),$(".ap-dialog .loading").loader({color:"blue"}),$(window).resize(function(){$(".ui-dialog-content").dialog("option","position",{my:"center",at:"center",of:window})}),$(".sticky").stickyMenu({stickyY:$("header").outerHeight(!0)+$(".breadcrumbs").outerHeight(!0)+$(".general > .alert.alert-notification").outerHeight(!0)+$(".report-header").height()-$(".report-header").find(".bar:last").outerHeight(!0)+24});var a=!1;$(document).on("click","#report-open",function(b){if(b.preventDefault(),!a){a=!0;var c=null;"undefined"!=typeof queryString.v&&(c=queryString.v);var d=$.toJSON({Id:$documentId,RepId:c,UserId:$userId});$.ajax({type:"POST",url:"/api/reports/openFullReport",data:d,dataType:"json",contentType:"application/json; charset=utf-8",timeout:6e4,success:function(b,c){if(b.success){var d="/report/full/"+$documentId,e="";"undefined"!=typeof queryString.v&&(e+="&v="+queryString.v),null!=$userId&&(e+="&userId="+$userId),e.length>0&&(e="?"+e.substring(1,e.length)),d+=e,window.location.href=d}else{a=!1;var f=new DialogHelper;f.modalHtml(b.message)}},error:function(b,c,d){if(a=!1,401==b.status)window.location.href="/";else{var e=new DialogHelper;e.modalText($.localize_report("Failed to open the report","~/wwwroot/js/report/short/shortReport.js"))}}})}}),$("a.source-link").externalUrl(),$(".sources-list .icons > i").qtip({content:{text:function(a){return $(this).attr("title")}},style:{classes:"qtip-ux qtip-multiline qtip-higher-zindex",tip:!0},position:{my:"center right",at:"center left",adjust:{y:0,x:0}},show:{event:"mouseover"},hide:{event:"mouseout"}}),$(".sources-list .icons > i.comment").qtip({content:{text:function(a){return $(this).next("span").html()}},style:{classes:"qtip-ux qtip-multiline qtip-higher-zindex qtip-comment",tip:!0},position:{my:"center right",at:"center left",adjust:{y:0,x:0}},show:{event:"mouseover"},hide:{event:"mouseout"}}),$(".toolbar-item.more > a").moreMenu(),$(".toolbar-item-disabled > a").click(function(a){a.preventDefault()}),$(".toolbar-item-disabled > a").qtip({content:{text:function(a){return $(this).attr("title")}},style:{classes:"qtip-ux qtip-multiline",tip:!0},position:{my:"center left",at:"center right",adjust:{y:0,x:0}},show:{event:"mouseover"},hide:{event:"mouseout"}})}),$(document).ready(function(){var a=$("#dialog-report-check-settings");$(document).on("click","#report-info, #sticky-report-info",function(b){b.preventDefault(),b.stopPropagation(),a.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,dialogClass:"ap-dialog-confirm ap-dialog-report-check-settings",open:function(){jQuery(".ui-widget-overlay").bind("click",function(){a.dialog("close")})},beforeClose:function(){},close:function(){},width:900,minHeight:218,closeText:$.localize_report("Close","~/wwwroot/js/report/common/reportCheckResults.js")}),a.dialog("open")})}),$(document).ready(function(){function a(){var e="";"undefined"!=typeof $reportViewMode&&$reportViewMode&&(e+="&viewMode="+$reportViewMode),null!=$userId&&(e+="&userId="+$userId),null!=$correctionNr&&(e+="&c="+$correctionNr),null!==$reportId&&(e+="&v="+$reportId),"undefined"!=typeof $isShortReport&&$isShortReport&&(e+="&short="+$isShortReport),"undefined"!=typeof $validationHash&&$validationHash&&(e+="&validationHash="+$validationHash),e.length>0&&(e="?"+e.substring(1,e.length)),$.ajax({type:"GET",url:($useRemoteMetrics?"/attributes/api/document/":$reportApi+"api/metrics/")+$documentId+"/semantic"+e,contentType:"application/json; charset=utf-8",timeout:6e4,success:function(e,f){if("InProgress"==e.status)setTimeout(a,$checkStatusInterval);else if("Done"==e.status)if(d=!1,0==e.semanticMetrics.length){b.dialog("close");var g=new DialogHelper;g.modalText($.localize_report("Semantic features not found","~/wwwroot/js/report/common/metrics.js"))}else{var h="";e.semanticMetrics.forEach(function(a){h+="<div>",a.description?(h+='<a class="right"><span>'+a.name+"</span>:<em>"+a.value+"</em><i></i></a>",h+='<div class="description">'+a.description+"</div>"):h+="<span>"+a.name+"</span>:<em>"+a.value+"</em>",h+="</div>\n"}),b.find(".semantic-features").html(h).show(),c.hide(),$(".ap-dialog-file-metrics .ui-dialog-titlebar").show(),b.dialog("option","position",{my:"center",at:"center",of:window})}else{d=!1,b.dialog("close");var g=new DialogHelper;g.modalText($.localize_report("Error in calculation semantic features","~/wwwroot/js/report/common/metrics.js"))}},error:function(a,c,e){if(d=!1,401==a.status)window.location.href="/";else{b.dialog("close");var f=new DialogHelper;f.modalText($.localize_report("Failed to get semantic features.","~/wwwroot/js/report/common/metrics.js"))}}})}var b=$("#dialog-file-metrics"),c=b.find(".loading"),d=!1;b.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,dialogClass:"ap-dialog-confirm ap-dialog-file-metrics",open:function(){jQuery(".ui-widget-overlay").bind("click",function(){d||b.dialog("close")})},beforeClose:function(){if(d)return!1},close:function(){c.hide()},width:700,minHeight:350,closeText:$.localize_report("Close","~/wwwroot/js/report/common/metrics.js")}),$(document).on("click","#document-metrics, #report-metrics, #sticky-report-metrics",function(e){e.preventDefault(),e.stopPropagation(),d||(d=!0,c.show(),b.dialog("open"),a())}),$(document).on("click","#dialog-file-metrics .file-metrics a",function(a){a.preventDefault(),a.stopPropagation();var b=$(this);b.hasClass("active")?b.removeClass("active"):($("#dialog-file-metrics .file-metrics a").not(b).removeClass("active"),b.addClass("active"))})});