$(document).ready(function(){function a(a,b){var c="";if(c+="<div class='history'>\n",c+="<div class='history-header'>\n<h2>"+$.localize_report("Report","~/wwwroot/js/common/reportHistory.js")+" â„–"+a.Id+"</h2>",null!=a.Date){var d=new Date(Date.parse(a.Date));c+="<span class='checked-date'><strong>"+$.localize_report("Checked","~/wwwroot/js/common/reportHistory.js")+":</strong><em>"+showFullDate(d)+"</em></span>"}if(null!=a.CheckTime&&(c+="<span class='check-time'><strong>"+$.localize_report("Check duration","~/wwwroot/js/common/reportHistory.js")+":</strong><em>"+showTime(a.CheckTime.DurationMs)+"</em></span>"),c+="</div>\n",null!=a.SearchPeriod){var e="",f="";if(null!=a.SearchPeriod.DateFrom){var g=new Date(Date.parse(a.SearchPeriod.DateFrom));e=$.localize_report("from","~/wwwroot/js/common/reportHistory.js")+" <em>"+showShortDate(g)+"</em> "}if(null!=a.SearchPeriod.DateTo){var h=new Date(Date.parse(a.SearchPeriod.DateTo));f=$.localize_report("to","~/wwwroot/js/common/reportHistory.js")+" <em>"+showShortDate(h)+"</em>"}c+="<div class='history-search-interval'><h3>"+$.localize_report("Search interval","~/wwwroot/js/common/reportHistory.js")+"</h3><div class='search-period'>"+e+f+"</div></div>"}if(null!=a.Corrections)for(var i=0;i<a.Corrections.length;i++){var j=b&&0===i;c+="<div class='history-item'>\n";var k=a.Corrections[i];if(c+="<div class='history-percents'><div class='percent'><div class='plagiat'><h3>"+$.localize_report("Plagiarism","~/wwwroot/js/common/reportHistory.js")+"</h3><em>"+roundNum(k.PlagiatPercent,2).toString().replace(".",",")+"%</em></div><div class='self-cite'><h3>"+$.localize_report("Self-citation","~/wwwroot/js/common/reportHistory.js")+"</h3><em>"+roundNum(k.SelfCitePercent,2).toString().replace(".",",")+"%</em></div><div class='legal'><h3>"+$.localize_report("Citation","~/wwwroot/js/common/reportHistory.js")+"</h3><em>"+roundNum(k.LegalPercent,2).toString().replace(".",",")+"%</em></div><div class='original'><h3>"+$.localize_report("Originality","~/wwwroot/js/common/reportHistory.js")+"</h3><em>"+roundNum(k.OriginalPercent,2).toString().replace(".",",")+"%</em></div></div><a class='btn-grey' href='"+k.Link+"'>"+$.localize_report("Open","~/wwwroot/js/common/reportHistory.js")+"</a><span class='"+(j?"up":"down")+"'></span></div>",null!=k.Date){var l=new Date(Date.parse(k.Date));c+="<div class='history-correction'><h3>"+$.localize_report("Correction","~/wwwroot/js/common/reportHistory.js")+":</h3><em>"+showFullDate(l)+"</em></div>"}c+="<div class='history-hidden'"+(j?"style='display: block;'":"")+">\n";var m=k.Description;if(k.AutoSave&&(m="["+$.localize_report("Autosaved version","~/wwwroot/js/common/reportHistory.js")+"]"),null!=m&&""!=m&&(c+="<div class='history-comment-header'><h3>"+$.localize_report("Comment","~/wwwroot/js/common/reportHistory.js")+"</h3></div>",c+="<div class='history-comment-desc'><p>"+m+"</p></div>"),null!=k.Collections&&k.Collections.length>0){c+="<div class='history-collections-header'><h3>"+$.localize_report("Revisions","~/wwwroot/js/common/reportHistory.js")+"</h3><div>";for(var n=0;n<k.Collections.length;n++){var o=k.Collections[n],p=o.OriginalPercent,q=o.LegalPercent,r=o.PlagiatPercent,s=o.SelfCitePercent;c+="<div class='history-collections-desc'><span class='collection' title='"+o.Description+"'>"+o.Description+"</span><span class='plagiat'>"+roundNum(r,2).toString().replace(".",",")+"%</span><span class='self-cite'>"+roundNum(s,2).toString().replace(".",",")+"%</span><span class='legal'>"+roundNum(q,2).toString().replace(".",",")+"%</span><span class='original'>"+roundNum(p,2).toString().replace(".",",")+"%</span>",o.Closed||(c+="<span class='in-process'>("+$.localize_report("checking process","~/wwwroot/js/common/reportHistory.js")+")</span>"),c+="</div>"}c+="</div></div>"}c+="</div>\n",c+="</div>\n"}return c+="</div>"}var b=null,c=null,d=null,e=null,f=null,g=null;$("input[type='hidden'][name='UserId']").length>0&&(c=parseInt($("input[type='hidden'][name='UserId']").val(),10)),$("input[type='hidden'][name='IsLast']").length>0&&(d=$("#IsLast").val().toLowerCase()),$("input[type='hidden'][name='RepId']").length>0&&(e=parseInt($("input[type='hidden'][name='RepId']").val(),10)),$("input[type='hidden'][name='ValidationHash']").length>0&&(g=$("#ValidationHash").val()),$("input[type='hidden'][name='ReportViewMode']").length>0&&(f=$("#ReportViewMode").val());var h=null,i=$("#dialog-report-history"),j=$("#dialog-report-history div.alert-error");j.hide();var k=i.find(".loading");i.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,dialogClass:"ap-dialog-confirm ap-dialog-report-history ap-dialog-with-title",buttons:[{}],open:function(){$(".ap-dialog-report-history .ui-dialog-buttonpane, .ap-dialog-report-history .ui-dialog-titlebar").hide(),jQuery(".ui-widget-overlay").bind("click",function(){h||i.dialog("close")})},beforeClose:function(){if(h)return!1},close:function(){j.hide(),k.hide()},width:900,minHeight:442,closeText:$.localize_report("Close","~/wwwroot/js/common/reportHistory.js")}),$(document).on("click",".ap-dialog-report-history .ui-dialog-title .manual",function(a){$(".main-inner > .report-summary").length>0?(setYMSummaryReportCounter("report_history_manual"),setGASummaryReportCounter("checkresults_report_history","report_history_manual")):$(".main-inner > .report-formatting").length>0&&(setYMFullReportCounter("report_history_manual"),setGAFullReportCounter("full_report_report_history","report_history_manual"))}),$(document).on("click",".ap-dialog-report-history .ui-dialog-titlebar-close",function(a){$(".main-inner > .report-summary").length>0?(setYMSummaryReportCounter("report_history_close_x"),setGASummaryReportCounter("checkresults_report_history","close_x")):$(".main-inner > .report-formatting").length>0&&(setYMFullReportCounter("report_history_close"),setGAFullReportCounter("full_report_report_history","close"))}),$(document).on("click",".dialog-report-history .history-percents > a.btn-grey",function(a){$(".main-inner > .report-summary").length>0?(setYMSummaryReportCounter("report_history_open_checkresults"),setGASummaryReportCounter("checkresults_report_history","open_checkresults")):$(".main-inner > .report-formatting").length>0&&(setYMFullReportCounter("report_history_checkresults"),setGAFullReportCounter("full_report_report_history","checkresults"))}),$(document).on("click","#report-history, #document-check-history, #sticky-document-check-history, #sticky-report-history",function(d){if(d.preventDefault(),d.stopPropagation(),$(this).parent().hasClass("toolbar-item-disabled"))return!1;if(b=null!=$(this).data("id")?$(this).data("id"):$('.document input[name="selectedCheckBoxes"]:checked').closest(".document").data("id"),!h){h=!0;var j="";$(".report-header .title > h2").length>0?j=$(".report-header .title > h2").text():$(".document").length>0&&(j=$('input[name="selectedCheckBoxes"]:checked').closest(".document").find(".name").text()),i.find(".history-list").hide(),i.find("h1").attr("title",j).text(j),k.show(),i.dialog("open");var l="";"undefined"!=typeof f&&f&&(l+="&viewMode="+f),"undefined"!=typeof c&&c&&(l+="&userId="+c),"undefined"!=typeof g&&g&&(l+="&validationHash="+g),"undefined"!=typeof e&&e&&(l+="&v="+e),l.length>0&&(l="?"+l.substring(1,l.length)),$.ajax({type:"GET",url:$reportApi+"api/history/"+b+l,contentType:"application/json; charset=utf-8",timeout:6e4,success:function(b,c){if(h=!1,b.length>0){for(var d="",e=0;e<b.length;e++)d+=a(b[e],0===e);i.find(".history-list").html(d).show(),k.hide(),$(".ap-dialog-report-history .ui-dialog-titlebar").show(),i.dialog("option","position",{my:"center",at:"center",of:window})}else{i.dialog("close");var f=new DialogHelper;f.modalText($.localize_report("Report history not found.","~/wwwroot/js/common/reportHistory.js"))}},error:function(a,b,c){if(h=!1,401==a.status)window.location.href="/";else{i.dialog("close");var d=new DialogHelper;d.modalText($.localize_report("Failed to get report history.","~/wwwroot/js/common/reportHistory.js"))}}})}}),$(document).on("click",".dialog-report-history .history-percents > span",function(a){var b=$(this),c=b.closest(".history-item").find(".history-hidden");$(".main-inner > .report-summary").length>0?(setYMSummaryReportCounter("report_history_hideshow_revision"),setGASummaryReportCounter("checkresults_report_history","hideshow_revision")):$(".main-inner > .report-formatting").length>0&&(setYMFullReportCounter("report_history_hideshow_revision"),setGAFullReportCounter("full_report_report_history","hideshow_revision")),b.hasClass("up")?(b.removeClass("up").addClass("down"),c.hide()):(b.removeClass("down").addClass("up"),c.show())})});